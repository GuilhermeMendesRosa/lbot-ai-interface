<!-- lbot-chat.component.html -->
<div class="chat-wrapper">
  <div class="chat-header">
    <h2>ðŸ¤– LBot Translator</h2>
    <button class="end-chat-btn" (click)="showObservationPopup()" title="Finalizar Chat" [disabled]="isWaitingForRating">
      âœ•
    </button>
  </div>

  <div class="chat-container">
  <div class="chat-messages">
    <div *ngFor="let message of messages" class="message" [ngClass]="message.type">
      {{ message.text }}
    </div>

    <div *ngIf="isLoading" class="message typing">
      Processando...
    </div>

    <div *ngIf="isWaitingForRating" class="message waiting">
      Aguarde {{ countdown }}s para avaliar a resposta...
    </div>
  </div>

  <div class="chat-input">
    <input type="text" [(ngModel)]="messageInput" (keypress)="onKeyPress($event)" placeholder="Digite seu comando..."
      autocomplete="off" [disabled]="isLoading || isWaitingForRating">
    <button (click)="sendMessage()" [disabled]="isLoading || !messageInput.trim() || isWaitingForRating">
      Enviar
    </button>
  </div>
  </div>
</div>

<!-- Popup de AvaliaÃ§Ã£o (apÃ³s cada mensagem) -->
<div *ngIf="showRating" class="rating-overlay" (click)="closeRatingPopup()">
  <div class="rating-popup" (click)="$event.stopPropagation()">
    <h3>Avalie esta resposta</h3>
    <p>Como vocÃª avalia a qualidade desta resposta?</p>

    <div class="stars-container">
      <span *ngFor="let star of [1,2,3,4,5]; let i = index"
            class="star"
            [class.filled]="i < selectedRating"
            [class.hover]="i < hoverRating"
            (click)="selectRating(i + 1)"
            (mouseenter)="hoverRating = i + 1"
            (mouseleave)="hoverRating = 0">
        â˜…
      </span>
    </div>

    <div class="rating-buttons">
      <button class="cancel-btn" (click)="closeRatingPopup()">Pular</button>
      <button class="submit-btn" (click)="submitRating()" [disabled]="selectedRating === 0">
        Avaliar
      </button>
    </div>
  </div>
</div>

<!-- Popup de ObservaÃ§Ã£o (ao finalizar chat) -->
<div *ngIf="showObservation" class="rating-overlay" (click)="closeObservationPopup()">
  <div class="rating-popup" (click)="$event.stopPropagation()">
    <h3>Finalizar Chat</h3>
    <p>Deixe suas observaÃ§Ãµes sobre a experiÃªncia geral:</p>

    <div class="observation-area">
      <label for="observation">ObservaÃ§Ãµes (opcional):</label>
      <textarea
        id="observation"
        [(ngModel)]="observation"
        placeholder="Deixe aqui seus comentÃ¡rios, sugestÃµes ou observaÃ§Ãµes sobre o LBot Translator..."
        rows="4">
      </textarea>
    </div>

    <div class="rating-buttons">
      <button class="cancel-btn" (click)="closeObservationPopup()">Cancelar</button>
      <button class="submit-btn" (click)="submitObservation()">
        Finalizar Chat
      </button>
    </div>
  </div>
</div>
